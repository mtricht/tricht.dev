<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="Michael van Tricht"><meta name=description content="H2O is an open source machine learning platform. With H2O Flow you&rsquo;re able to train models through a web interface, R or python. With H2O Steam you&rsquo;re able to deploy the trained models, allowing you to call a HTTP endpoint to predict user behavior. Are you planning to host Flow and Steam on your own server? Here are a few things we learned by doing."><meta name=keywords content="blog,developer,personal,resume"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hosting H2O Flow and Steam"><meta name=twitter:description content="H2O is an open source machine learning platform. With H2O Flow you&rsquo;re able to train models through a web interface, R or python. With H2O Steam you&rsquo;re able to deploy the trained models, allowing you to call a HTTP endpoint to predict user behavior. Are you planning to host Flow and Steam on your own server? Here are a few things we learned by doing."><meta property="og:title" content="Hosting H2O Flow and Steam"><meta property="og:description" content="H2O is an open source machine learning platform. With H2O Flow you&rsquo;re able to train models through a web interface, R or python. With H2O Steam you&rsquo;re able to deploy the trained models, allowing you to call a HTTP endpoint to predict user behavior. Are you planning to host Flow and Steam on your own server? Here are a few things we learned by doing."><meta property="og:type" content="article"><meta property="og:url" content="https://tricht.dev/post/hosting-h2o-flow-and-steam/"><meta property="article:published_time" content="2018-03-08T20:25:00+02:00"><meta property="article:modified_time" content="2018-03-08T20:25:00+02:00"><base href=https://tricht.dev/post/hosting-h2o-flow-and-steam/><title>Hosting H2O Flow and Steam Â· Michael van Tricht</title><link rel=canonical href=https://tricht.dev/post/hosting-h2o-flow-and-steam/><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.0/css/all.css integrity=sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=/css/coder.min.fce3d3684e836ce340cdd591dad1749c310472d5ed4049fab99845c9aec4d4bf.css integrity="sha256-/OPTaE6DbONAzdWR2tF0nDEEctXtQEn6uZhFya7E1L8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.717236c74e0a5208ef73964a9f44c6b443b689a95b270d8b2a40d0c012460dac.css integrity="sha256-cXI2x04KUgjvc5ZKn0TGtEO2ialbJw2LKkDQwBJGDaw=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/extra.css><link rel=icon type=image/png href=https://tricht.dev/images/favicon.ico sizes=32x32><link rel=icon type=image/png href=https://tricht.dev/images/favicon.ico sizes=16x16><link rel=apple-touch-icon href=https://tricht.dev/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://tricht.dev/images/apple-touch-icon.png><meta name=generator content="Hugo 0.74.3"></head><body class=colorscheme-dark><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Michael van Tricht</a>
<span id=dark-mode-toggle class=float-right><i class="fas fa-adjust fa-fw"></i></span><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fas fa-bars fa-fw"></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://tricht.dev/about/>About</a></li><li class=navigation-item><a class=navigation-link href=https://tricht.dev/post/>Blog</a></li><li class="navigation-item separator"><span>|</span></li></ul></section></nav><div class=content><section class="container page"><article><header><h1>Hosting H2O Flow and Steam</h1></header><p><a href=https://www.h2o.ai/>H2O</a> is an open source machine learning platform. With H2O Flow you&rsquo;re able to train models through a web interface, R or python. With H2O Steam you&rsquo;re able to deploy the trained models, allowing you to call a HTTP endpoint to predict user behavior. Are you planning to host Flow and Steam on your own server? Here are a few things we learned by doing.</p><p>Getting H2O up and running is rather simple. It consists of two .jar files you have to download and run. The <a href=http://docs.h2o.ai/>docs</a> are great for getting started.</p><p>When we started, we started off by separating flow and Steam between two servers. We did this because the Steam deployments are continuously under heavy load predicting user behavior. And we don&rsquo;t want flow, which would be training new models using the full CPU, to interfere with these deployments.</p><h2 id=steam-doesnt-keep-deployments-running>Steam doesn&rsquo;t keep deployments running</h2><p>Once we had our servers up and trained our models, we started deploying the models and using them. This goes all smoothly through Steam&rsquo;s web interface.</p><p>Sadly, however after a reboot of the server to increase the RAM, we found out none of the Steam deployments were actually running. When you deploy an endpoint Steam compiles it to a <code>.war</code> file, starts it and stores the process ID in it&rsquo;s SQLite database. But Steam doesn&rsquo;t manage the deployment. So once the deployment is killed for whatever reason, some parts of the UI become unresponsive.</p><p>To fix this, we created a rather simple Go application called the <a href=https://github.com/ExpandOnline/h2o-steam-overseer>h2o-steam-overseer</a> which is open source and can be found on github. What does it do? Using the Steam SQLite database it fetches the process ID of the deployments and checks if they&rsquo;re running. If they&rsquo;re not running it starts the deployment and updates the SQLite database with the correct process ID. We run the h2o-steam-overseer every 30 minutes through the crontab like so;</p><p><code>30 * * * * /home/steam/h2o-steam-overseer /home/steam/steam-1.1.6-linux-amd64</code></p><h2 id=r-and-flows-savemodel-and-loadmodel-functions>R and Flow&rsquo;s saveModel and loadModel functions</h2><p>The R library for H2O Flow has two functions called <code>saveModel</code> and <code>loadModel</code>. These functions are self-explanatory, they save and load a model respectively. But what isn&rsquo;t self-explanatory is that when you call these functions from your R studio, the models are saved and loaded on the <em>server</em> not on the machine where R studio is running. This isn&rsquo;t something that&rsquo;s very intuitive and we make sure to store in a directory that&rsquo;s recognizable eg. <code>~/models/customer-name/trained-model-march-2018</code>.</p><h2 id=dont-forget-to-backup>Don&rsquo;t forget to backup</h2><p>We simply backup the entire H2O Flow and Steam directories. If you want to be more specific;</p><ol><li>For H2O Flow you&rsquo;d backup wherever you saved your trained models.</li><li>For H2O Steam you&rsquo;d backup the directory containing all model deployments which would be <code>~/steam/var/master/model</code>.</li></ol></article></section></div><footer class=footer><section class=container></section></footer></main><script src=/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script><script>(function(f,a,t,h,o,m){a[h]=a[h]||function(){(a[h].q=a[h].q||[]).push(arguments)};o=f.createElement('script'),m=f.getElementsByTagName('script')[0];o.async=1;o.src=t;o.id='fathom-script';m.parentNode.insertBefore(o,m)})(document,window,'//analytics.tricht.dev/tracker.js','fathom');fathom('set','siteId','TMBWC');fathom('trackPageview');</script></body></html>